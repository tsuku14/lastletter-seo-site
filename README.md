# LAST LETTER SEO サイト

終活・相続の総合情報サイトのGitHub Actions自動化システムです。

## 概要

このリポジトリは、OpenAI APIを使用して終活・相続に関する高品質な記事を自動生成し、SEO最適化されたサイトとして公開するためのシステムです。

## 主な機能

1. **自動記事生成** - 毎日自動で新しい記事を生成
2. **バッチ記事生成** - 手動で最大30記事を一括生成
3. **AIレビュー** - 生成された記事の品質を自動チェック
4. **サイトマップ自動更新** - 記事追加時に自動でサイトマップを更新

## セットアップ

### 必要な環境

- Node.js 18以上
- npmまたはyarn
- GitHubアカウント
- OpenAI APIキー

### 環境変数の設定

GitHubリポジトリのSettings > Secrets and variablesで以下のシークレットを設定してください：

- `OPENAI_API_KEY` - OpenAI APIのキー（必須）
- `GITHUB_TOKEN` - 自動で設定されます

### ローカル開発

```bash
# リポジトリのクローン
git clone https://github.com/tsuku14/lastletter-seo-site.git
cd lastletter-seo-site

# 依存関係のインストール
npm install

# 開発サーバーの起動
npm run dev
```

## GitHub Actionsワークフロー

### 1. 自動記事生成 (generate-content.yml)

- **実行タイミング**: 毎日午前0時（UTC）
- **手動実行**: 可能
- **機能**: 
  - 1記事を自動生成
  - サイトマップを更新
  - 変更を自動コミット

### 2. バッチ記事生成 (batch-generate.yml)

- **実行タイミング**: 手動実行のみ
- **パラメータ**: 生成する記事数（デフォルト: 30）
- **機能**: 
  - 指定された数の記事を一括生成
  - API制限対策のため3秒間隔で生成
  - サイトマップを更新

### 3. AIレビュー (ai-review.yml)

- **実行タイミング**: mainブランチへのプッシュ時
- **機能**: 
  - 変更された記事をAIでレビュー
  - 品質問題をGitHub Issueとして報告

## エラー対策

### 実装済みのエラー対策

1. **API制限対策**
   - リトライロジック（最大3回）
   - レート制限時の待機処理
   - バッチ処理での間隔設定

2. **同時実行制御**
   - concurrencyグループによる排他制御
   - 同じワークフローの同時実行を防止

3. **エラーハンドリング**
   - OpenAI APIキーの存在確認
   - ネットワークエラーのリトライ
   - Git操作の競合解決
   - フォールバック処理

4. **ログ出力**
   - 詳細なエラーメッセージ
   - 進捗状況の表示
   - 生成結果のサマリー

## トラブルシューティング

### よくあるエラーと対処法

#### 1. OpenAI APIエラー

**症状**: `401 Authentication error`
**原因**: APIキーが無効または未設定
**対処**: 
- GitHub Secretsで`OPENAI_API_KEY`が正しく設定されているか確認
- APIキーの有効期限を確認

**症状**: `429 Rate limit exceeded`
**原因**: API使用量の上限到達
**対処**: 
- OpenAIダッシュボードで使用量を確認
- 必要に応じてプランをアップグレード
- バッチサイズを減らす

#### 2. Git操作エラー

**症状**: `failed to push some refs`
**原因**: リモートリポジトリとの競合
**対処**: 
- ワークフローは自動的にpullしてリトライします
- 手動介入は不要

#### 3. ファイル/ディレクトリエラー

**症状**: `No such file or directory`
**原因**: 必要なディレクトリが存在しない
**対処**: 
- スクリプトが自動的にディレクトリを作成します
- 手動介入は不要

## 運用のベストプラクティス

1. **定期的な監視**
   - GitHub Actionsの実行履歴を週1回確認
   - 失敗したワークフローの原因を調査

2. **APIキーの管理**
   - 定期的にAPIキーをローテーション
   - 使用量を監視し、上限に近づいたら対策

3. **記事の品質管理**
   - AIレビューで報告されたIssueを確認
   - 必要に応じて手動で記事を修正

4. **バックアップ**
   - 生成された記事を定期的にバックアップ
   - リポジトリ全体のバックアップも推奨

## 開発者向け情報

### ディレクトリ構造

```
.
├── .github/
│   └── workflows/        # GitHub Actionsワークフロー
├── articles/            # 生成された記事
├── scripts/             # 生成・処理スクリプト
│   ├── generate-batch.js
│   ├── ai-review.js
│   └── generate-sitemap.js
├── public/              # 静的ファイル
│   └── sitemap.xml
└── package.json
```

### スクリプトの拡張

新しいトピックを追加する場合は、`scripts/generate-batch.js`の`topics`配列に追加してください。

## ライセンス

MIT

## サポート

問題が発生した場合は、GitHubのIssuesで報告してください。