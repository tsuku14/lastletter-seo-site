const fs = require('fs');
const path = require('path');
const OpenAI = require('openai');

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

// æœ€ã‚‚æ¤œç´¢ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®é«˜ã„ãƒˆãƒƒãƒ—5è¨˜äº‹
const top5Topics = [
  {
    title: "çµ‚æ´»ã¨ã¯ï¼Ÿã„ã¤ã‹ã‚‰å§‹ã‚ã‚‹ï¼Ÿ40ä»£ãƒ»50ä»£ãƒ»60ä»£ã®çµ‚æ´»ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ",
    keywords: ["çµ‚æ´»ã¨ã¯", "çµ‚æ´» ã„ã¤ã‹ã‚‰", "çµ‚æ´» ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ", "çµ‚æ´» 40ä»£", "çµ‚æ´» 50ä»£"],
    category: "ç”Ÿå‰æº–å‚™",
    description: "çµ‚æ´»ã®æ„å‘³ã‚„å§‹ã‚ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€å¹´ä»£åˆ¥ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’è©³ã—ãè§£èª¬ã€‚40ä»£ãƒ»50ä»£ãƒ»60ä»£ãã‚Œãã‚Œã®çµ‚æ´»ãƒã‚¤ãƒ³ãƒˆã‚’ã‚ã‹ã‚Šã‚„ã™ãç´¹ä»‹ã—ã¾ã™ã€‚"
  },
  {
    title: "ç›¸ç¶šç¨ãŒã‹ã‹ã‚‰ãªã„è²¡ç”£ä¸€è¦§ï½œéèª²ç¨æ ã‚’æœ€å¤§é™æ´»ç”¨ã™ã‚‹æ–¹æ³•",
    keywords: ["ç›¸ç¶šç¨ ã‹ã‹ã‚‰ãªã„", "ç›¸ç¶šç¨ éèª²ç¨", "ç›¸ç¶šç¨ ã„ãã‚‰ã‹ã‚‰", "ç›¸ç¶šç¨ åŸºç¤æ§é™¤"],
    category: "ç›¸ç¶šç¨",
    description: "ç›¸ç¶šç¨ãŒã‹ã‹ã‚‰ãªã„è²¡ç”£ã‚„éèª²ç¨æ ã«ã¤ã„ã¦è©³ã—ãè§£èª¬ã€‚åŸºç¤æ§é™¤ã®è¨ˆç®—æ–¹æ³•ã‹ã‚‰ã€ç”Ÿå‘½ä¿é™ºã‚„ä¸å‹•ç”£ã‚’ä½¿ã£ãŸç¯€ç¨å¯¾ç­–ã¾ã§ç¶²ç¾…çš„ã«ç´¹ä»‹ã€‚"
  },
  {
    title: "ç›¸ç¶šæ‰‹ç¶šãã®æœŸé™ä¸€è¦§è¡¨ï½œ3ãƒ¶æœˆãƒ»4ãƒ¶æœˆãƒ»10ãƒ¶æœˆä»¥å†…ã«ã‚„ã‚‹ã“ã¨",
    keywords: ["ç›¸ç¶šæ‰‹ç¶šã æœŸé™", "ç›¸ç¶š 3ãƒ¶æœˆ", "ç›¸ç¶š 10ãƒ¶æœˆ", "ç›¸ç¶šæ‰‹ç¶šã ä¸€è¦§"],
    category: "ç›¸ç¶šæ‰‹ç¶šã",
    description: "ç›¸ç¶šæ‰‹ç¶šãã®æœŸé™ã‚’ä¸€è¦§è¡¨ã§ã‚ã‹ã‚Šã‚„ã™ãè§£èª¬ã€‚ç›¸ç¶šæ”¾æ£„ã®3ãƒ¶æœˆã€æº–ç¢ºå®šç”³å‘Šã®4ãƒ¶æœˆã€ç›¸ç¶šç¨ç”³å‘Šã®10ãƒ¶æœˆãªã©ã€æœŸé™åˆ¥ã«å¿…è¦ãªæ‰‹ç¶šãã‚’ç´¹ä»‹ã€‚"
  },
  {
    title: "å®¶æ—è‘¬ã®è²»ç”¨ç›¸å ´ã¯ï¼Ÿ20ä¸‡å††ã€œ100ä¸‡å††ã®å†…è¨³ã¨å®‰ãã™ã‚‹æ–¹æ³•",
    keywords: ["å®¶æ—è‘¬ è²»ç”¨", "å®¶æ—è‘¬ ç›¸å ´", "å®¶æ—è‘¬ å®‰ã„", "å®¶æ—è‘¬ã¨ã¯"],
    category: "è‘¬å„€ãƒ»ãŠå¢“",
    description: "å®¶æ—è‘¬ã®è²»ç”¨ç›¸å ´ã‚’è©³ã—ãè§£èª¬ã€‚20ä¸‡å††ã‹ã‚‰100ä¸‡å††ã¾ã§å¹…ãŒã‚ã‚‹ç†ç”±ã¨ã€è²»ç”¨ã‚’æŠ‘ãˆã‚‹ãƒã‚¤ãƒ³ãƒˆã€ä¸€èˆ¬è‘¬ã¨ã®é•ã„ã‚’ã‚ã‹ã‚Šã‚„ã™ãèª¬æ˜ã€‚"
  },
  {
    title: "ç”Ÿå‰æ•´ç†ã¯ã„ã¤ã‹ã‚‰ï¼Ÿ40ä»£ãƒ»50ä»£ãƒ»60ä»£ã®æ–­æ¨é›¢ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ",
    keywords: ["ç”Ÿå‰æ•´ç†", "ç”Ÿå‰æ•´ç† ã„ã¤ã‹ã‚‰", "ç”Ÿå‰æ•´ç† ã‚„ã‚Šæ–¹", "æ–­æ¨é›¢ çµ‚æ´»"],
    category: "ç”Ÿå‰æº–å‚™",
    description: "ç”Ÿå‰æ•´ç†ã‚’å§‹ã‚ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨å…·ä½“çš„ãªæ–¹æ³•ã‚’å¹´ä»£åˆ¥ã«è§£èª¬ã€‚40ä»£ã‹ã‚‰å§‹ã‚ã‚‹æ–­æ¨é›¢ã®ã‚³ãƒ„ã¨ã€å®¶æ—ã«è¿·æƒ‘ã‚’ã‹ã‘ãªã„æ•´ç†è¡“ã‚’ç´¹ä»‹ã€‚"
  }
];

// SEOæœ€é©åŒ–ã•ã‚ŒãŸè¨˜äº‹ç”Ÿæˆé–¢æ•°
async function generateTopSEOArticle(topic, index) {
  const prompt = `ã‚ãªãŸã¯æ—¥æœ¬ä¸€ã®SEOå°‚é–€ãƒ©ã‚¤ã‚¿ãƒ¼ã§ã™ã€‚ä»¥ä¸‹ã®æ¡ä»¶ã§ã€Googleæ¤œç´¢1ä½ã‚’ç²å¾—ã§ãã‚‹è¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

ã€è¨˜äº‹æƒ…å ±ã€‘
ã‚¿ã‚¤ãƒˆãƒ«: ${topic.title}
ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ${topic.keywords.join(', ')}
ã‚«ãƒ†ã‚´ãƒª: ${topic.category}

ã€å¿…é ˆè¦ä»¶ã€‘
1. 4000æ–‡å­—ä»¥ä¸Šã®å……å®Ÿã—ãŸå†…å®¹
2. æ¤œç´¢æ„å›³ã‚’120%æº€ãŸã™ç¶²ç¾…çš„ãªæƒ…å ±
3. E-E-A-Tã‚’æº€ãŸã™å°‚é–€çš„ã§ä¿¡é ¼ã§ãã‚‹å†…å®¹
4. èª­ã¿ã‚„ã™ãã€ãƒ¢ãƒã‚¤ãƒ«ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªæ§‹æˆ
5. 2024å¹´ã®æœ€æ–°æƒ…å ±ã‚’å«ã‚ã‚‹

ã€è¨˜äº‹æ§‹æˆã€‘
# ${topic.title}

## ç›®æ¬¡

ï¼ˆå°å…¥æ–‡ï¼š200æ–‡å­—ã§èª­è€…ã®æ‚©ã¿ã«å…±æ„Ÿã—ã€ã“ã®è¨˜äº‹ã§è§£æ±ºã§ãã‚‹ã“ã¨ã‚’æ˜ç¤ºï¼‰

## å„ãƒ¡ã‚¤ãƒ³è¦‹å‡ºã—ï¼ˆH2ï¼‰
- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è‡ªç„¶ã«å«ã‚ã‚‹
- å…·ä½“çš„ã§å®Ÿç”¨çš„ãªå†…å®¹
- è¡¨ã‚„ç®‡æ¡æ›¸ãã‚’åŠ¹æœçš„ã«ä½¿ç”¨

## ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰
- 5ã¤ä»¥ä¸Šã®è³ªå•ã¨å›ç­”
- æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿å¯¾å¿œ

## ã¾ã¨ã‚
- è¦ç‚¹ã‚’ç®‡æ¡æ›¸ãã§æ•´ç†
- æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ˜ç¢ºã«æç¤º

## é–¢é€£æƒ…å ±
- LAST LETTERã‚µãƒ¼ãƒ“ã‚¹ã®è‡ªç„¶ãªç´¹ä»‹

Markdownå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚`;

  try {
    console.log(`ğŸ“ ç”Ÿæˆé–‹å§‹: ${topic.title}`);
    
    const completion = await openai.chat.completions.create({
      model: "gpt-4-turbo-preview",
      messages: [
        {
          role: "system",
          content: "ã‚ãªãŸã¯çµ‚æ´»ãƒ»ç›¸ç¶šåˆ†é‡ã®æ—¥æœ¬ä¸€ã®SEOå°‚é–€ãƒ©ã‚¤ã‚¿ãƒ¼ã§ã™ã€‚èª­è€…ã«æœ€é«˜ã®ä¾¡å€¤ã‚’æä¾›ã—ã€Googleæ¤œç´¢ã§1ä½ã‚’ç²å¾—ã™ã‚‹è¨˜äº‹ã‚’ä½œæˆã—ã¾ã™ã€‚"
        },
        {
          role: "user",
          content: prompt
        }
      ],
      max_tokens: 4000,
      temperature: 0.7,
    });

    const articleContent = completion.choices[0].message.content;
    
    // æ—¥ä»˜ç”Ÿæˆ
    const date = new Date();
    date.setDate(date.getDate() + index);
    const dateStr = date.toISOString().split('T')[0];
    
    // Frontmatterç”Ÿæˆ
    const frontmatter = `---
title: "${topic.title}"
date: "${dateStr}"
category: "${topic.category}"
keywords: [${topic.keywords.map(k => `"${k}"`).join(', ')}]
description: "${topic.description}"
---

`;

    const content = frontmatter + articleContent;
    const slug = topic.keywords[0].replace(/\s+/g, '-').toLowerCase();
    const filename = `${dateStr}-${slug}.md`;
    const filepath = path.join(process.cwd(), 'articles', filename);
    
    fs.writeFileSync(filepath, content, 'utf-8');
    console.log(`âœ… å®Œäº†: ${filename}`);
    
    return true;
    
  } catch (error) {
    console.error(`âŒ ã‚¨ãƒ©ãƒ¼: ${topic.title}`, error.message);
    return false;
  }
}

// ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œ
async function main() {
  console.log('ğŸš€ ãƒˆãƒƒãƒ—5 SEOè¨˜äº‹ã®ç”Ÿæˆé–‹å§‹\n');
  
  for (let i = 0; i < top5Topics.length; i++) {
    await generateTopSEOArticle(top5Topics[i], i);
    
    if (i < top5Topics.length - 1) {
      console.log('â³ å¾…æ©Ÿä¸­...\n');
      await new Promise(resolve => setTimeout(resolve, 5000));
    }
  }
  
  console.log('\nâœ… ã™ã¹ã¦ã®è¨˜äº‹ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼');
}

if (require.main === module) {
  main().catch(console.error);
}

module.exports = { generateTopSEOArticle, top5Topics };